---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - PLC/Sources/01_DB_States.scl
  - PLC/Sources/02_DB_Config.scl
autonomous: true

must_haves:
  truths:
    - "DB_States contains all 9 state constants with INT values 0-8"
    - "DB_Config contains all CFG_ timer parameters with TIME type defaults"
    - "State numbering matches FDS section 2.2 order"
    - "Files use correct TIA Portal v20 SCL syntax"
  artifacts:
    - path: "PLC/Sources/01_DB_States.scl"
      provides: "State constants for state machine"
      contains: "STATE_HOMING.*:= 0"
    - path: "PLC/Sources/02_DB_Config.scl"
      provides: "Configuration parameters"
      contains: "CFG_LaagToerenMs.*Time.*T#"
  key_links:
    - from: "DB_States"
      to: "FB_HekBesturing"
      via: "State constant references"
      pattern: "DB_States.STATE_"
    - from: "DB_Config"
      to: "FB_HekBesturing"
      via: "Timer parameter references"
      pattern: "DB_Config.Timers"
---

<objective>
Create global data blocks for state constants and configuration parameters.

Purpose: Establish the data foundation that all other blocks depend on. DB_States provides named constants for the 9-state state machine, avoiding magic numbers. DB_Config provides all CFG_ timer parameters with documented defaults.

Output: Two SCL files ready for TIA Portal v20 import that compile without errors.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/01-foundation/01-RESEARCH.md (SCL syntax reference)
@.planning/phases/01-foundation/01-CONTEXT.md (implementation decisions)
@.planning/REQUIREMENTS.md (CODE-05, CODE-06)
@FDS-Automatisch-Hek-v0.2.md (state descriptions, timer parameters)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DB_States with state and direction constants</name>
  <files>PLC/Sources/01_DB_States.scl</files>
  <action>
Create `PLC/Sources/01_DB_States.scl` with:

1. Header comment block in Dutch explaining purpose
2. DATA_BLOCK declaration with:
   - Name: "DB_States"
   - Attribute: { S7_Optimized_Access := 'TRUE' }
   - VERSION : 0.1
   - NON_RETAIN

3. STRUCT containing state constants (per FDS section 2.2 order):
   - STATE_HOMING : Int := 0;        // Zoeken referentiepositie bij opstart
   - STATE_IDLE_OPEN : Int := 1;     // Hek volledig open, motor uit
   - STATE_IDLE_DICHT : Int := 2;    // Hek volledig dicht, alarm aan
   - STATE_MOVING_OPEN : Int := 3;   // Beweging richting open
   - STATE_MOVING_DICHT : Int := 4;  // Beweging richting dicht
   - STATE_STOPPED : Int := 5;       // Gestopt in tussenpositie
   - STATE_VS_PAUSE : Int := 6;      // Gepauzeerd door lichtsluis
   - STATE_PBV_RETRACT : Int := 7;   // Terugtrekken na bumperactivatie
   - STATE_FAULT : Int := 8;         // Sensorstoring gedetecteerd

4. Direction constants:
   - DIR_NONE : Int := 0;            // Geen richting
   - DIR_OPEN : Int := 1;            // Richting OPEN
   - DIR_DICHT : Int := 2;           // Richting DICHT

5. Empty BEGIN/END_DATA_BLOCK (no initialization needed)

Follow exact syntax from RESEARCH.md "Complete Global DB Example" section.
  </action>
  <verify>
File exists and contains:
- All 9 STATE_ constants with values 0-8
- All 3 DIR_ constants with values 0-2
- S7_Optimized_Access attribute
- Valid SCL syntax (no obvious errors)
  </verify>
  <done>
DB_States.scl exists with all state constants matching FDS section 2.2 numbering.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DB_Config with timer and safety parameters</name>
  <files>PLC/Sources/02_DB_Config.scl</files>
  <action>
Create `PLC/Sources/02_DB_Config.scl` with:

1. Header comment block in Dutch explaining purpose
2. DATA_BLOCK declaration with:
   - Name: "DB_Config"
   - Attribute: { S7_Optimized_Access := 'TRUE' }
   - VERSION : 0.1
   - NON_RETAIN

3. STRUCT organized into categories (per CONTEXT.md decisions):

**Timers STRUCT** (all TIME type with T# format, per FDS section 8):
- CFG_LaagToerenMs : Time := T#5S;        // Duur lage snelheid bij start
- CFG_PBV_PauzeMs : Time := T#500MS;      // Pauze voor terugtrekken na PBV
- CFG_PBV_TerugtrekMs : Time := T#3S;     // Max duur terugtrekbeweging
- CFG_VS_HervattingMs : Time := T#2S;     // Wachttijd na beam herstel
- CFG_VS_LaagToerenMs : Time := T#2S;     // Lage snelheid na VS hervatting
- CFG_BewegingTimeoutS : Time := T#90S;   // Bewegingstimeout
- CFG_EndstopDebounceMs : Time := T#50MS; // Debounce eindstand/PBV

**Safety STRUCT:**
- CFG_VS_DebounceMs : Time := T#100MS;    // VS debounce tijd

**Motor STRUCT** (placeholder for future):
- Comment: // Toekomstige motorparameters

**Limits STRUCT** (placeholder for future):
- Comment: // Toekomstige limietwaarden

**Debug STRUCT:**
- SimulatieActief : Bool := FALSE;        // Debug simulatiemodus

4. Empty BEGIN/END_DATA_BLOCK

Follow exact syntax from RESEARCH.md with nested STRUCTs.
  </action>
  <verify>
File exists and contains:
- All 7 CFG_ timer parameters in Timers STRUCT
- CFG_VS_DebounceMs in Safety STRUCT
- TIME type with T# format for all timers
- S7_Optimized_Access attribute
  </verify>
  <done>
DB_Config.scl exists with all CFG_ parameters grouped into STRUCTs with correct TIME defaults.
  </done>
</task>

</tasks>

<verification>
Both data blocks ready for TIA Portal import:
1. `PLC/Sources/01_DB_States.scl` - 9 state constants, 3 direction constants
2. `PLC/Sources/02_DB_Config.scl` - All CFG_ parameters with TIME defaults

Syntax verification:
- All blocks have S7_Optimized_Access := 'TRUE'
- All blocks use NON_RETAIN
- TIME values use T# format (T#5S, T#500MS, etc.)
- Dutch comments throughout
</verification>

<success_criteria>
- [ ] DB_States.scl contains STATE_HOMING through STATE_FAULT (0-8)
- [ ] DB_States.scl contains DIR_NONE, DIR_OPEN, DIR_DICHT (0-2)
- [ ] DB_Config.scl contains all 8 CFG_ parameters from FDS
- [ ] All timer parameters use TIME type with T# format
- [ ] Both files use correct TIA Portal v20 SCL DATA_BLOCK syntax
- [ ] Files are ready for Plan 02 (function blocks) to reference
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
