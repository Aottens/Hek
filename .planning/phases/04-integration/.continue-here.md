---
phase: 04-integration
task: 0
total_tasks: TBD
status: not_started
last_updated: 2026-02-03
---

<current_state>
Phase 3 (State Machine) complete and verified. Ready to start Phase 4 (Integration).

Project is at a clean checkpoint — all committed, no WIP. Phase 4 needs planning first.
</current_state>

<completed_work>

- Phase 1: Foundation (2 plans) - DB_States, DB_Config, block structure
- Phase 2: Safety Core (2 plans) - FB_Veiligheid, debouncing, priority logic
- Phase 3: State Machine (3 plans) - 9 states, control inputs, safety responses

Total: 7 plans completed, 30 requirements marked Complete
</completed_work>

<remaining_work>

Phase 4: Integration (not yet planned)

**Goal:** Complete system with timer sequences, output mapping, and full OB1 orchestration

**Success Criteria:**
1. Motor outputs are mutually exclusive (never both q_MS_Open and q_MS_Dicht active)
2. Low speed timer pauses on stop and resets on direction change
3. Alarm output inverted correctly (q_AlarmKerk = 0 when gate closed)
4. All timer sequences execute with configurable durations from DB_Config

**Requirements to implement:**
- TMR-01..09: Timer sequences (low speed, PBV pause/retract, VS resume delay)
- OUT-01..06: Output mapping and mutual exclusion

**Phase 4 needs to add:**
- VS resume delay (CFG_VS_HervattingMs) - currently immediate
- Low speed control (CFG_LaagToerenMs) - not yet implemented
- PBV pause before retract (CFG_PBV_PauzeMs)
- FC_Outputs implementation
</remaining_work>

<decisions_made>

Key decisions from Phase 3 affecting Phase 4:
- VS_PAUSE currently resumes immediately — Phase 4 adds CFG_VS_HervattingMs delay timer
- Motor outputs assigned in FB_HekBesturing output CASE — Phase 4 may move to FC_Outputs
- Low speed output (q_MS_LaagToeren) placeholder exists, needs timer logic

Architectural decisions:
- Physical I/O addresses in OB1 only (blocks use symbolic parameters)
- Config parameters in nested STRUCTs (Timers, Safety, Motor, Limits, Debug)
- FB instances in DB_HekData STRUCT (m_Veiligheid, m_HekBesturing)
</decisions_made>

<blockers>
None. Clean state.
</blockers>

<context>
The state machine is complete with all 9 states and transitions. What remains is the "polish" layer:
- Timer sequences that control low speed at movement start/resume
- Proper VS resume delay (not immediate)
- PBV pause before retract begins
- FC_Outputs to map state machine outputs to physical I/O

The heavy lifting (state logic, safety responses, control inputs) is done. Phase 4 is mostly wiring timer logic and output mapping.
</context>

<next_action>
Run: /gsd:discuss-phase 4

Or to skip discussion: /gsd:plan-phase 4

Phase 4 success criteria are already defined in ROADMAP.md. Planning will break it into concrete tasks.
</next_action>
