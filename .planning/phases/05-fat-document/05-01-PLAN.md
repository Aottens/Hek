---
phase: 05-fat-document
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - FAT-Automatisch-Hek.md
autonomous: true

must_haves:
  truths:
    - "Tester can identify document version, date, and project context"
    - "Tester can verify each of the 7 in-scope inputs by toggling sensor and checking PLC value"
    - "Tester can verify each of the 4 in-scope outputs by observing actuator response"
    - "Tester can walk through all 9 states with expected motor/alarm behavior"
    - "Tester can record Pass/Fail and notes in Remarks column"
  artifacts:
    - path: "FAT-Automatisch-Hek.md"
      provides: "Document structure, I/O section, State Machine section"
      contains: "## 1. Document Informatie"
    - path: "FAT-Automatisch-Hek.md"
      provides: "Input verification table"
      contains: "i_SS_SleutelSchakelaarOpen"
    - path: "FAT-Automatisch-Hek.md"
      provides: "Output verification table"
      contains: "q_MS_Open"
    - path: "FAT-Automatisch-Hek.md"
      provides: "State machine test table"
      contains: "STATE_IDLE_DICHT"
  key_links:
    - from: "FAT-Automatisch-Hek.md"
      to: "IO-LIJST.md"
      via: "I/O addresses match"
      pattern: "%I0\\.[0-9]|%I1\\.[0-9]|%Q0\\.[0-9]"
    - from: "FAT-Automatisch-Hek.md"
      to: "statemachine.mmd"
      via: "State transitions match"
      pattern: "IDLE_DICHT|MOVING_OPEN|STOPPED"
---

<objective>
Create FAT document foundation with I/O verification and State Machine sections.

Purpose: Establish document structure and enable testers to verify hardware I/O and state machine behavior.
Output: FAT-Automatisch-Hek.md with Header, I/O Verification, and State Machine sections.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/05-fat-document/05-RESEARCH.md
@IO-LIJST.md
@statemachine.mmd
@FDS-Automatisch-Hek-v0.2.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FAT document structure with Header and I/O sections</name>
  <files>FAT-Automatisch-Hek.md</files>
  <action>
Create FAT-Automatisch-Hek.md with the following structure:

**Section 1: Document Informatie**
- Table with: Document title, Version (v1.0), Date, Project, PLC Platform (S7-1212C)
- Test personnel signature fields (Tester, Witness, Date)
- Equipment identification fields (PLC Serial, HMI Serial, etc.)

**Section 2: Input Verification (7 inputs)**
Create table with columns: Test ID | Tag | Adres | Test Actie | Verwacht | Pass/Fail | Opmerkingen

Include all 7 in-scope inputs from IO-LIJST.md:
1. IO-INP-01: i_SS_SleutelSchakelaarOpen (%I0.1) - Turn key to OPEN position, verify PLC shows 1
2. IO-INP-02: i_DK_Bediening (%I0.2) - Press button, verify PLC shows 0 (NC: 0=pressed)
3. IO-INP-03: i_SS_SleutelSchakelaarDicht (%I0.3) - Turn key to DICHT position, verify PLC shows 1
4. IO-INP-04: i_BNS_Open (%I0.7) - Push gate to OPEN limit, verify PLC shows 0 (NC: 0=reached)
5. IO-INP-05: i_BNS_Dicht (%I1.0) - Push gate to DICHT limit, verify PLC shows 0 (NC: 0=reached)
6. IO-INP-06: i_PBV_BeweegbaarHek (%I1.2) - Press rubber bumper, verify PLC shows 1 (NC inverted: 1=trigger)
7. IO-INP-07: i_VS_Voertuig (%I1.3) - Block beam, verify PLC shows 0 (0=blocked)

**Section 3: Output Verification (4 outputs)**
Create table with columns: Test ID | Tag | Adres | Test Conditie | Verwacht | Pass/Fail | Opmerkingen

Include all 4 in-scope outputs:
1. IO-OUT-01: q_AlarmKerk (%Q0.3) - Gate at IDLE_DICHT, verify output = 0 (fail-safe: 0=alarm ON)
2. IO-OUT-02: q_MS_Open (%Q0.4) - Gate in MOVING_OPEN, verify output = 1
3. IO-OUT-03: q_MS_Dicht (%Q0.5) - Gate in MOVING_DICHT or HOMING, verify output = 1
4. IO-OUT-04: q_MS_LaagToeren (%Q0.6) - During HOMING or first 5s of movement, verify output = 1

Use Dutch language for descriptions to match FDS. Every test has Pass/Fail checkbox [ ] and Opmerkingen column.
  </action>
  <verify>
File exists at FAT-Automatisch-Hek.md. Contains sections 1-3. grep confirms: "IO-INP-01" through "IO-INP-07" and "IO-OUT-01" through "IO-OUT-04" present.
  </verify>
  <done>
Document has header section with metadata, 7 input tests with addresses matching IO-LIJST.md, 4 output tests with addresses.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add State Machine verification section</name>
  <files>FAT-Automatisch-Hek.md</files>
  <action>
Append Section 4: State Machine Tests to FAT-Automatisch-Hek.md

**Section 4.1: State Behavior Tests (9 states)**
Create table with columns: Test ID | State | Motor Open | Motor Dicht | LaagToeren | Alarm | Pass/Fail | Opmerkingen

Include all 9 states from DB_States with expected outputs from FB_HekBesturing:
1. SM-STATE-01: HOMING - Motor: OFF/ON/ON, Alarm: OFF (1)
2. SM-STATE-02: IDLE_OPEN - Motor: OFF/OFF/OFF, Alarm: OFF (1)
3. SM-STATE-03: IDLE_DICHT - Motor: OFF/OFF/OFF, Alarm: ON (0, fail-safe)
4. SM-STATE-04: MOVING_OPEN - Motor: ON/OFF/(timer), Alarm: OFF (1)
5. SM-STATE-05: MOVING_DICHT - Motor: OFF/ON/(timer), Alarm: OFF (1)
6. SM-STATE-06: STOPPED - Motor: OFF/OFF/OFF, Alarm: OFF (1)
7. SM-STATE-07: VS_PAUSE - Motor: OFF/OFF/OFF, Alarm: OFF (1)
8. SM-STATE-08: PBV_RETRACT (pause phase) - Motor: OFF/OFF/OFF, Alarm: OFF (1)
9. SM-STATE-08b: PBV_RETRACT (retract phase) - Motor: ON/OFF/ON, Alarm: OFF (1)
10. SM-STATE-09: FAULT - Motor: OFF/OFF/OFF, Alarm: OFF (1)

**Section 4.2: State Transition Tests**
Create table with columns: Test ID | Voorwaarde | Trigger | Verwacht State | Pass/Fail | Opmerkingen

Include all transitions from statemachine.mmd (approximately 25 transitions):

Power-on transitions (4):
- SM-TRANS-01: Power On + BNS_Dicht active -> IDLE_DICHT
- SM-TRANS-02: Power On + BNS_Open active -> IDLE_OPEN
- SM-TRANS-03: Power On + no endstop -> HOMING
- SM-TRANS-04: Power On + both endstops -> FAULT

HOMING transitions (3):
- SM-TRANS-05: HOMING + BNS_Dicht reached -> IDLE_DICHT
- SM-TRANS-06: HOMING + PBV or VS trigger -> STOPPED
- SM-TRANS-07: HOMING + both endstops -> FAULT

IDLE transitions (4):
- SM-TRANS-08: IDLE_DICHT + Key OPEN -> MOVING_OPEN
- SM-TRANS-09: IDLE_OPEN + Key DICHT -> MOVING_DICHT
- SM-TRANS-10: IDLE_DICHT + both endstops -> FAULT
- SM-TRANS-11: IDLE_OPEN + both endstops -> FAULT

Movement transitions (10):
- SM-TRANS-12: MOVING_OPEN + BNS_Open -> IDLE_OPEN
- SM-TRANS-13: MOVING_DICHT + BNS_Dicht -> IDLE_DICHT
- SM-TRANS-14: MOVING_OPEN + Push button -> STOPPED
- SM-TRANS-15: MOVING_DICHT + Push button -> STOPPED
- SM-TRANS-16: MOVING_OPEN + VS beam blocked -> VS_PAUSE
- SM-TRANS-17: MOVING_DICHT + VS beam blocked -> VS_PAUSE
- SM-TRANS-18: MOVING_OPEN + PBV trigger -> PBV_RETRACT
- SM-TRANS-19: MOVING_DICHT + PBV trigger -> PBV_RETRACT
- SM-TRANS-20: MOVING_OPEN + both endstops -> FAULT
- SM-TRANS-21: MOVING_DICHT + both endstops -> FAULT

Continue with STOPPED, VS_PAUSE, PBV_RETRACT, FAULT transitions.

Use Dutch for descriptions where appropriate. Reference statemachine.mmd as source.
  </action>
  <verify>
grep "SM-STATE-01" FAT-Automatisch-Hek.md returns result. grep "SM-TRANS-" FAT-Automatisch-Hek.md shows transition tests.
  </verify>
  <done>
Section 4 contains all 9 states with motor/alarm behaviors, and all state transitions from statemachine.mmd with preconditions and triggers.
  </done>
</task>

</tasks>

<verification>
After completion:
1. FAT-Automatisch-Hek.md exists in repository root
2. Document contains 4 main sections (Header, Inputs, Outputs, State Machine)
3. All I/O addresses match IO-LIJST.md exactly
4. All states match DB_States values
5. All transitions match statemachine.mmd
6. Every test row has Pass/Fail and Opmerkingen columns
</verification>

<success_criteria>
Requirements covered:
- IO-01: Input checkbox section present (7 inputs)
- IO-02: Output checkbox section present (4 outputs)
- IO-03: Each I/O entry has tag, address, expected behavior, checkbox
- STATE-01: All 9 states with motor/alarm behavior
- STATE-02: All state transitions from statemachine.mmd
- STATE-03: Each state test has Test ID, Description, Expected Result, Pass/Fail, Remarks
- DOC-01: Document is Markdown format
- DOC-02: Consistent table structure throughout
- DOC-03: All tables have Remarks column
</success_criteria>

<output>
After completion, create `.planning/phases/05-fat-document/05-01-SUMMARY.md`
</output>
