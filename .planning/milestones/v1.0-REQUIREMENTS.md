# Requirements Archive: v1.0 Automatic Sliding Gate Control

**Archived:** 2026-02-06
**Status:** SHIPPED

This is the archived requirements specification for v1.0.
For current project work, see `.planning/PROJECT.md` (Validated section).

---

## v1 Requirements

### State Machine (SM) - 9/9 Complete

- [x] **SM-01**: Implement 9-state state machine per statemachine.mmd
- [x] **SM-02**: HOMING state on power-up with unknown position (no endstop active)
- [x] **SM-03**: HOMING moves toward DICHT at low speed
- [x] **SM-04**: HOMING aborts to STOPPED on PBV or VS trigger
- [x] **SM-05**: IDLE_OPEN when i_BNS_Open active (=0)
- [x] **SM-06**: IDLE_DICHT when i_BNS_Dicht active (=0)
- [x] **SM-07**: FAULT when both endstops active simultaneously
- [x] **SM-08**: FAULT auto-recovers when sensors return to valid state
- [x] **SM-09**: STOPPED state for manual stop or after PBV retract in mid-position

### Control (CTL) - 8/8 Complete

- [x] **CTL-01**: Key switch OPEN (i_SS_SleutelSchakelaarOpen) starts movement toward OPEN
- [x] **CTL-02**: Key switch DICHT (i_SS_SleutelSchakelaarDicht) starts movement toward DICHT
- [x] **CTL-03**: Key switch uses rising edge detection (no debounce)
- [x] **CTL-04**: Push button (i_DK_Bediening) toggles stop/resume on falling edge (NC: 0 = pressed)
- [x] **CTL-05**: Push button from STOPPED resumes last active direction
- [x] **CTL-06**: Key switch from STOPPED starts in selected direction (overrides last direction)
- [x] **CTL-07**: Opposing key direction while moving -> stop and wait for new input
- [x] **CTL-08**: After timeout/stop, key must be released before new input accepted

### Safety (SAF) - 12/12 Complete

- [x] **SAF-01**: Priority order: FAULT > PBV > VS
- [x] **SAF-02**: PBV trigger (i_PBV_BeweegbaarHek = 1) -> immediate stop
- [x] **SAF-03**: PBV always retracts toward OPEN (regardless of movement direction)
- [x] **SAF-04**: PBV retract at low speed for max CFG_PBV_TerugtrekMs or until endstop
- [x] **SAF-05**: PBV ignores all operator input during retract
- [x] **SAF-06**: PBV debounce: CFG_EndstopDebounceMs (50ms)
- [x] **SAF-07**: VS trigger (i_VS_Voertuig = 0, NC sensor) -> immediate pause
- [x] **SAF-08**: VS auto-resumes in same direction after beam clear + CFG_VS_HervattingMs
- [x] **SAF-09**: VS ignores operator input during pause (auto-resume has priority)
- [x] **SAF-10**: VS debounce: 100ms
- [x] **SAF-11**: Movement timeout: CFG_BewegingTimeoutS (90s) -> STOPPED
- [x] **SAF-12**: HOMING uses same timeout as normal movement

### Timers (TMR) - 9/9 Complete

- [x] **TMR-01**: CFG_LaagToerenMs (5000ms) - low speed duration at movement start
- [x] **TMR-02**: CFG_PBV_PauzeMs (500ms) - pause before PBV retract
- [x] **TMR-03**: CFG_PBV_TerugtrekMs (3000ms) - max PBV retract duration
- [x] **TMR-04**: CFG_VS_HervattingMs (2000ms) - delay after beam clear before resume
- [x] **TMR-05**: CFG_VS_LaagToerenMs (2000ms) - low speed duration after VS resume
- [x] **TMR-06**: CFG_BewegingTimeoutS (90s) - movement timeout (seconds)
- [x] **TMR-07**: CFG_EndstopDebounceMs (50ms) - endstop/PBV debounce
- [x] **TMR-08**: Low speed timer pauses on stop, resets on direction change
- [x] **TMR-09**: Timers called outside CASE statement, Q captured once per scan

### Sensors (SEN) - 4/4 Complete

- [x] **SEN-01**: Endstop BNS_Open debounce: CFG_EndstopDebounceMs
- [x] **SEN-02**: Endstop BNS_Dicht debounce: CFG_EndstopDebounceMs
- [x] **SEN-03**: All safety sensors NC (fail-safe: wire break = trigger)
- [x] **SEN-04**: VS sensor NC: 0 = beam blocked, 1 = beam intact

### Outputs (OUT) - 6/6 Complete

- [x] **OUT-01**: q_MS_Open = motor direction OPEN
- [x] **OUT-02**: q_MS_Dicht = motor direction DICHT
- [x] **OUT-03**: q_MS_LaagToeren = low speed active
- [x] **OUT-04**: q_AlarmKerk = 0 when gate closed (fail-safe: PLC off = alarm active)
- [x] **OUT-05**: Motor outputs mutually exclusive (never both active)
- [x] **OUT-06**: All outputs default FALSE, only enabled in specific states

### Code Structure (CODE) - 6/6 Complete

- [x] **CODE-01**: Main OB1 calls blocks in order: FC_Veiligheid -> FB_HekBesturing -> FC_Outputs
- [x] **CODE-02**: FB_HekBesturing contains state machine with instance DB
- [x] **CODE-03**: FC_Veiligheid handles safety priority and sensor processing
- [x] **CODE-04**: FC_Outputs maps state to physical outputs
- [x] **CODE-05**: DB_Config holds all CFG_ parameters
- [x] **CODE-06**: Generate SCL external source files (.scl) for TIA Portal import

---

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| SM-01 through SM-09 | Phase 3 | Complete |
| CTL-01 through CTL-08 | Phase 3 | Complete |
| SAF-01, SAF-02, SAF-06, SAF-07, SAF-10 | Phase 2 | Complete |
| SAF-03, SAF-04, SAF-05, SAF-08, SAF-09, SAF-11, SAF-12 | Phase 3 | Complete |
| TMR-01 through TMR-09 | Phase 4 | Complete |
| SEN-01 through SEN-04 | Phase 2 | Complete |
| OUT-01 through OUT-06 | Phase 4 | Complete |
| CODE-01 through CODE-06 | Phase 1 | Complete |

---

## Milestone Summary

**Shipped:** 42 of 42 v1 requirements
**Adjusted:** None
**Dropped:** None

All requirements implemented as specified. No scope changes during milestone execution.

---

*Archived: 2026-02-06 as part of v1.0 milestone completion*
